import { useParams, Link } from "react-router-dom";
import { Helmet } from "react-helmet-async";
import { ArrowLeft, ArrowRight, Share2, MessageCircle } from "lucide-react";
import { Button } from "@/components/ui/button";
import { Card, CardContent } from "@/components/ui/card";

// Моковые данные для статей с исправленными датами (формат YYYY-MM-DD)
const blogPosts = [
  {
    id: 1,
    title: "Мелодия судьбы: как услышать ритм своего пути",
    description: "А что, если даты — это не просто числа, а загадочные отражения твоей жизни? Каждый день рождения, каждое событие — это нота в мелодии, которую ты сочиняешь, сам того не замечая. Числовые созвучия — как зеркала, где мелькают твои мечты, корни и тайные силы.",
    content: `
      А что, если даты — это не просто числа, а загадочные отражения твоей жизни? Каждый день рождения, каждое событие — это нота в мелодии, которую ты сочиняешь, сам того не замечая. Числовые созвучия — как зеркала, где мелькают твои мечты, корни и тайные силы. Они не приказывают, а зовут: «Взгляни глубже — кто ты? Куда идёшь?» Это шепот Вселенной, полный загадок и возможностей, доступный каждому, кто решит прислушаться.

      Здесь нет строгих рамок, только приглашение — вдохновиться, понять себя и выбрать свой путь. Давай отправимся в это путешествие, где время станет твоим проводником, а даты — ключами к сокровищам твоей души.

      ### Почему даты имеют значение?
      Каждая дата в твоей жизни — это не случайность. День рождения, важные события, даже случайные встречи — всё это несёт определённую энергию. В нумерологии мы используем числа, чтобы понять, как эти энергии влияют на нас. Например, твоя дата рождения может рассказать о твоих сильных сторонах, слабостях и предназначении.

      ### Как начать слушать свою мелодию?
      1. **Рассчитай своё число судьбы**: Сложи все цифры своей даты рождения (день, месяц, год) и приведи их к однозначному числу. Например, если ты родился 15.03.1990: 1 + 5 + 0 + 3 + 1 + 9 + 9 + 0 = 28, затем 2 + 8 = 10, 1 + 0 = 1. Твоё число судьбы — 1.
      2. **Пойми его значение**: Число 1 говорит о лидерстве, независимости и стремлении к новым начинаниям.
      3. **Применяй в жизни**: Используй это знание, чтобы принимать решения, которые соответствуют твоей внутренней энергии.

      ### Что дальше?
      Нумерология — это не магия, а инструмент. Она помогает увидеть закономерности, которые ты, возможно, не замечал. Если ты хочешь глубже погрузиться в эту тему, запишись на консультацию, где я помогу тебе раскрыть твою мелодию судьбы.
    `,
    date: "2025-03-31", // Исправленный формат
    displayDate: "31 марта 2025", // Для отображения
    image: "/images/blog-post-1.jpg",
    category: "Основы",
    popular: true,
    readingTime: "5 минут",
  },
  {
    id: 2,
    title: "Как найти общий язык с детьми и близкими через цифры",
    description: "Вы когда-нибудь задумывались, почему некоторые люди так легко находят общий язык с окружающими, а другие сталкиваются с трудностями в общении? Или почему вам так сложно понять своего ребенка, даже когда вы стараетесь изо всех сил?",
    content: `
      Вы когда-нибудь задумывались, почему некоторые люди так легко находят общий язык с окружающими, а другие сталкиваются с трудностями в общении? Или почему вам так сложно понять своего ребенка, даже когда вы стараетесь изо всех сил? Это может быть связано с тем, что мы часто не осознаем, как влияют внутренние особенности личности на наше восприятие мира и взаимодействие с ним. Но что, если я скажу вам, что существует способ разобраться в этих особенностях и наладить связь с собой и с близкими?

      В этой статье мы разберём, как числа могут стать ключом к пониманию и гармонии в отношениях. Нумерология позволяет увидеть, как энергии чисел влияют на характер, поведение и взаимодействие с другими людьми.

      ### Шаг 1: Рассчитай число личности
      Число личности можно рассчитать, сложив цифры дня рождения. Например, если твой ребёнок родился 12-го числа: 1 + 2 = 3. Число 3 говорит о творческой, общительной натуре, но также о склонности к перепадам настроения.

      ### Шаг 2: Пойми, как это влияет на общение
      Если у твоего ребёнка число 3, он, скорее всего, любит быть в центре внимания, но может расстраиваться, если его не понимают. Зная это, ты можешь дать ему больше пространства для самовыражения, но при этом мягко направлять его.

      ### Шаг 3: Сравни с твоим числом
      Рассчитай своё число личности и посмотри, как оно сочетается с числом ребёнка. Например, если у тебя число 8 (лидерство, организованность), ты можешь быть слишком строгим для ребёнка с числом 3. Попробуй смягчить подход, добавив больше игры и лёгкости в общение.

      ### Заключение
      Числа — это не волшебная палочка, но они помогают увидеть, где могут возникать конфликты, и как их избежать. Хочешь узнать больше о совместимости с близкими? Запишись на консультацию, и я помогу тебе построить гармоничные отношения.
    `,
    date: "2025-04-05", // Исправленный формат
    displayDate: "5 апреля 2025", // Для отображения
    image: "/images/blog-post-2.jpg",
    category: "Личный опыт",
    readingTime: "6 минут",
  },
  {
    id: 3,
    title: "Мой путь в нумерологии",
    description: "Личный опыт: как я начала использовать метод Александрова и что это изменило.",
    content: `
      Личный опыт: как я начала использовать метод Александрова и что это изменило. Моя история началась с простого любопытства — я хотела понять, почему некоторые события в моей жизни повторяются, а другие остаются недостижимыми. Нумерология стала для меня инструментом, который помог не только разобраться в себе, но и найти внутреннюю гармонию.

      ### Мой первый шаг
      Всё началось с книги Александрова, где я узнала о методе психоматрицы. Я рассчитала свою матрицу и была поражена, насколько точно числа описали мои сильные и слабые стороны. Например, я всегда знала, что у меня есть лидерские качества, но не понимала, почему мне так сложно расслабляться. Оказалось, что у меня переизбыток энергии "восьмёрок", что делает меня слишком требовательной к себе.

      ### Что изменилось?
      После этого я начала применять нумерологию в повседневной жизни. Я научилась лучше понимать свои циклы: когда стоит браться за новые проекты, а когда лучше отдохнуть. Это помогло мне снизить уровень стресса и найти баланс.

      ### Советы для новичков
      Если ты только начинаешь, не пытайся сразу всё понять. Начни с простого: рассчитай своё число судьбы и прочитай, что оно означает. Затем попробуй применить это знание в жизни. А если хочешь глубже погрузиться, приходи на консультацию — я с радостью помогу тебе начать этот путь.
    `,
    date: "2025-04-10", // Исправленный формат
    displayDate: "10 апреля 2025", // Для отображения
    image: "/images/blog-post-3.jpg",
    category: "Личный опыт",
    readingTime: "4 минуты",
  },
  {
    id: 4,
    title: "Число года: как рассчитать и использовать для планирования",
    description: "Каждый год несёт свою энергию, которая влияет на твои решения и события. Узнай, как рассчитать своё число года и использовать его для планирования важных шагов в жизни.",
    content: `
      Каждый год несёт свою энергию, которая влияет на твои решения и события. Узнай, как рассчитать своё число года и использовать его для планирования важных шагов в жизни. В этой статье я расскажу, как определить своё число года, что оно означает и как применять его для достижения целей.

      ### Как рассчитать число года?
      Число года рассчитывается просто: сложи цифры текущего года и своего дня и месяца рождения. Например, для 2025 года и даты рождения 15.03: 2 + 0 + 2 + 5 + 1 + 5 + 0 + 3 = 18, затем 1 + 8 = 9. Твоё число года — 9.

      ### Что означает число года?
      Число 9 — это год завершения цикла. Это время подводить итоги, отпускать старое и готовиться к новому. В этот год лучше не начинать масштабные проекты, а сосредоточиться на внутреннем росте.

      ### Как использовать?
      Зная своё число года, ты можешь планировать свои действия в гармонии с энергией года. Например, в год с числом 9 стоит заняться самоанализом, избавиться от ненужных вещей и отношений, чтобы освободить место для нового. Хочешь узнать, что ждёт тебя в этом году? Запишись на консультацию, и я помогу тебе составить план.
    `,
    date: "2025-04-15", // Исправленный формат
    displayDate: "15 апреля 2025", // Для отображения
    image: "/images/blog-post-4.jpg",
    category: "Практика",
    readingTime: "5 минут",
  },
  {
    id: 5,
    title: "5 мифов о нумерологии, которые мешают тебе начать",
    description: "Нумерология окружена мифами: от скептицизма до магических ожиданий. Разбираем 5 самых популярных заблуждений и показываем, как числа могут стать твоим инструментом для самопознания.",
    content: `
      Нумерология окружена мифами: от скептицизма до магических ожиданий. Разбираем 5 самых популярных заблуждений и показываем, как числа могут стать твоим инструментом для самопознания.

      ### Миф 1: Нумерология — это гадание
      На самом деле нумерология — это не про предсказания, а про понимание закономерностей. Она помогает увидеть твои сильные и слабые стороны, чтобы ты мог принимать более осознанные решения.

      ### Миф 2: Это слишком сложно
      Нумерология может быть простой. Начни с расчёта своего числа судьбы — это займёт 5 минут, а результат даст тебе много пищи для размышлений.

      ### Миф 3: Числа решают за тебя
      Числа не диктуют, что делать. Они лишь показывают энергии, которые тебя окружают, а выбор всегда за тобой.

      ### Миф 4: Это работает только для верующих
      Нумерология — это не религия. Это система, основанная на математике и наблюдениях, которая работает независимо от твоих убеждений.

      ### Миф 5: Нумерология не точна
      Конечно, она не даст 100% точности, но она удивительно точно описывает тенденции. Попробуй рассчитать своё число и убедись сама.

      ### Что дальше?
      Если ты готова начать, начни с малого — рассчитай своё число судьбы. А если хочешь глубже погрузиться, приходи на консультацию, и я помогу тебе разобраться.
    `,
    date: "2025-04-20", // Исправленный формат
    displayDate: "20 апреля 2025", // Для отображения
    image: "/images/blog-post-5.jpg",
    category: "Основы",
    readingTime: "7 минут",
  },
  {
    id: 6,
    title: "Как числа помогают справляться с тревогой и стрессом",
    description: "В современном мире стресс стал частью жизни, но числа могут стать твоими союзниками. Узнай, как использовать нумерологию для гармонии и внутреннего спокойствия.",
    content: `
      В современном мире стресс стал частью жизни, но числа могут стать твоими союзниками. Узнай, как использовать нумерологию для гармонии и внутреннего спокойствия. В этой статье я расскажу, как числа могут помочь понять источники твоей тревоги, найти внутренний баланс и справиться с напряжением.

      ### Почему мы чувствуем стресс?
      Стресс часто возникает, когда мы идём против своей внутренней энергии. Например, если твоё число судьбы — 2 (чувствительность, гармония), а ты постоянно находишься в конфликтах, это будет вызывать напряжение.

      ### Как числа помогают?
      1. **Определи своё число судьбы**: Это поможет понять, какие ситуации для тебя естественны, а какие вызывают стресс.
      2. **Следуй своему ритму**: Если у тебя число 2, тебе важно избегать конфликтов и создавать вокруг себя гармоничную обстановку.
      3. **Используй числа для релакса**: Например, число 4 ассоциируется с природой. Если ты чувствуешь тревогу, проведи время на свежем воздухе.

      ### Практическое упражнение
      Рассчитай своё число дня (сложи цифры сегодняшней даты). Если сегодня 03.04.2025: 0 + 3 + 0 + 4 + 2 + 0 + 2 + 5 = 16, 1 + 6 = 7. Число 7 говорит о том, что сегодня день для размышлений и уединения. Проведи вечер с книгой или медитацией.

      ### Заключение
      Нумерология — это простой способ понять себя и свои эмоции. Хочешь узнать, как числа могут помочь тебе справляться со стрессом? Запишись на консультацию, и я помогу тебе найти гармонию.
    `,
    date: "2025-04-25", // Исправленный формат
    displayDate: "25 апреля 2025", // Для отображения
    image: "/images/blog-post-6.jpg",
    category: "Практика",
    readingTime: "6 минут",
  },
];

const BlogPostPage = () => {
  const { id } = useParams<{ id: string }>();
  const postId = parseInt(id || "0", 10); // Убедимся, что id парсится корректно
  const post = blogPosts.find((p) => p.id === postId);

  // Навигация: предыдущая и следующая статьи
  const currentIndex = blogPosts.findIndex((p) => p.id === postId);
  const prevPost = currentIndex > 0 ? blogPosts[currentIndex - 1] : null;
  const nextPost = currentIndex < blogPosts.length - 1 ? blogPosts[currentIndex + 1] : null;

  // Похожие статьи (на основе категории)
  const relatedPosts = blogPosts
    .filter((p) => p.category === post?.category && p.id !== postId)
    .slice(0, 3);

  if (!post) {
    return (
      <div className="container mx-auto px-4 py-20 text-center">
        <h1 className="text-3xl font-bold text-gray-800 mb-4">Статья не найдена</h1>
        <Button asChild>
          <Link to="/blog" className="flex items-center gap-2">
            <ArrowLeft className="h-4 w-4" />
            Вернуться к списку
          </Link>
        </Button>
      </div>
    );
  }

  // Создаём объект structuredData только если дата валидна
  const structuredData = {
    "@context": "https://schema.org",
    "@type": "Article",
    headline: post.title,
    description: post.description,
    image: post.image,
    datePublished: new Date(post.date).toISOString(), // Теперь дата в формате YYYY-MM-DD
    author: {
      "@type": "Person",
      name: "Ольга Хаустова",
    },
  };

  return (
    <>
      <Helmet>
        <title>{post.title} | Khaustova Matrix</title>
        <meta name="description" content={post.description} />
        <meta property="og:title" content={post.title} />
        <meta property="og:description" content={post.description} />
        <meta property="og:image" content={post.image} />
        <meta property="og:type" content="article" />
        <meta property="og:url" content={`https://khaustova-matrix.ru/blog/${post.id}`} />
        <script type="application/ld+json">{JSON.stringify(structuredData)}</script>
      </Helmet>
      <section className="py-20 bg-gradient-to-b from-white to-[#F0F7F4]">
        <div className="container mx-auto px-4">
          {/* Хлебные крошки */}
          <div className="text-sm text-gray-500 mb-6">
            <Link to="/" className="hover:underline">Главная</Link> &gt;{" "}
            <Link to="/blog" className="hover:underline">Блог</Link> &gt;{" "}
            <span className="text-gray-700">{post.title}</span>
          </div>

          {/* Кнопка "Назад" */}
          <Button asChild variant="outline" className="mb-6">
            <Link to="/blog" className="flex items-center gap-2">
              <ArrowLeft className="h-4 w-4" />
              Назад к списку
            </Link>
          </Button>

          {/* Шапка статьи */}
          <div className="max-w-3xl mx-auto">
            <div className="relative mb-8">
              <img
                src={post.image}
                alt={post.title}
                className="w-full h-96 object-cover rounded-lg"
              />
              <div className="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent rounded-lg"></div>
              <div className="absolute bottom-4 left-4 text-white">
                <span className="text-sm bg-black/60 px-2 py-1 rounded-full">{post.category}</span>
              </div>
            </div>

            <h1 className="text-4xl font-bold text-[#1A3C34] mb-4 font-serif">{post.title}</h1>
            <div className="flex items-center gap-2 text-gray-600 mb-6">
              <span>{post.displayDate}</span> {/* Используем displayDate для отображения */}
              <span>·</span>
              <span>{post.readingTime}</span>
            </div>

            {/* Контент статьи */}
            <div className="prose prose-lg text-gray-700 mb-12">
              {post.content.split("\n").map((paragraph, index) => (
                <p key={index} className="mb-4">
                  {paragraph}
                </p>
              ))}
            </div>

            {/* Кнопки шаринга */}
            <div className="flex gap-3 mb-12">
              <Button variant="outline" asChild>
                <a
                  href={`https://t.me/share/url?url=${encodeURIComponent(`/blog/${post.id}`)}&text=${encodeURIComponent(post.title)}`}
                  target="_blank"
                  rel="noopener noreferrer"
                  className="flex items-center gap-2"
                >
                  <MessageCircle className="h-4 w-4" />
                  Telegram
                </a>
              </Button>
              <Button variant="outline" asChild>
                <a
                  href={`https://wa.me/?text=${encodeURIComponent(post.title + " " + `/blog/${post.id}`)}`}
                  target="_blank"
                  rel="noopener noreferrer"
                  className="flex items-center gap-2"
                >
                  <Share2 className="h-4 w-4" />
                  WhatsApp
                </a>
              </Button>
            </div>

            {/* Навигация: Предыдущая и Следующая статьи */}
            <div className="flex justify-between mb-12">
              {prevPost ? (
                <Button asChild variant="outline">
                  <Link to={`/blog/${prevPost.id}`} className="flex items-center gap-2">
                    <ArrowLeft className="h-4 w-4" />
                    Предыдущая
                  </Link>
                </Button>
              ) : (
                <div></div>
              )}
              {nextPost && (
                <Button asChild variant="outline">
                  <Link to={`/blog/${nextPost.id}`} className="flex items-center gap-2">
                    Следующая
                    <ArrowRight className="h-4 w-4" />
                  </Link>
                </Button>
              )}
            </div>

            {/* CTA: Призыв к действию */}
            <div className="bg-gradient-to-r from-[#5D9B89]/10 to-[#F0F7F4] p-6 rounded-lg text-center mb-12">
              <h3 className="text-xl font-bold text-[#1A3C34] mb-2">
                Хочешь узнать больше о себе через числа?
              </h3>
              <p className="text-gray-600 mb-4">
                Запишись на консультацию, и я помогу тебе раскрыть твою матрицу личности.
              </p>
              <Button asChild className="bg-[#5D9B89] hover:bg-[#3A6E5A] text-white">
                <a href="https://t.me/NeikaSparkBot" target="_blank" rel="noopener noreferrer">
                  Записаться
                </a>
              </Button>
            </div>

                        {/* Похожие статьи */}
                        {relatedPosts.length > 0 && (
              <div>
                <h3 className="text-2xl font-bold text-[#1A3C34] mb-6">Похожие статьи</h3>
                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                  {relatedPosts.map((relatedPost) => (
                    <Card
                      key={relatedPost.id}
                      className="border border-gray-100 bg-white/90 shadow-sm hover:shadow-lg transition-all duration-300 rounded-lg"
                    >
                      <Link to={`/blog/${relatedPost.id}`}>
                        <CardContent className="p-4">
                          <img
                            src={relatedPost.image}
                            alt={relatedPost.title}
                            className="w-full h-40 object-cover rounded-md mb-4"
                          />
                          <h4 className="text-lg font-bold text-[#1A3C34] mb-2">
                            {relatedPost.title}
                          </h4>
                          <p className="text-gray-600 text-sm line-clamp-2">
                            {relatedPost.description}
                          </p>
                        </CardContent>
                      </Link>
                    </Card>
                  ))}
                </div>
              </div>
            )}
          </div>
        </div>
      </section>
    </>
  );
};

export default BlogPostPage;